<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GraphQL Test (local)</title>
    <link rel="stylesheet" href="app.css" />
    <style>
      h2 {
        margin: 0 0 6px;
        font-size: 22px;
        letter-spacing: -0.02em;
      }
      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
        margin-top: 12px;
      }
      @media (max-width: 900px) {
        .row {
          grid-template-columns: 1fr;
        }
      }
      textarea {
        height: 180px;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        font-size: 13px;
      }
      button#btn {
        margin-top: 12px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <div class="row" style="align-items: baseline">
          <div>
            <h2>Local GraphQL 테스트</h2>
            <div class="muted">
              서버 실행 후 이 페이지를 열면 바로 호출할 수 있어요. (기본 endpoint:
              <code>/graphql</code>)
            </div>
          </div>
        </div>

        <div class="row">
          <div class="card" style="border: none; box-shadow: none; padding: 0">
            <h3 style="margin: 0 0 10px">Query</h3>
            <textarea id="query"></textarea>
            <div class="spacer-12"></div>
            <h3 style="margin: 0 0 10px">Variables (JSON)</h3>
            <textarea id="vars"></textarea>
            <button id="btn">Send</button>
          </div>
          <div class="card" style="border: none; box-shadow: none; padding: 0">
            <h3 style="margin: 0 0 10px">Result</h3>
            <pre id="out"></pre>
          </div>
        </div>
      </div>
    </div>

    <script>
      const queryEl = document.getElementById("query");
      const varsEl = document.getElementById("vars");
      const outEl = document.getElementById("out");
      const btn = document.getElementById("btn");
      const graphqlUrl =
        location.protocol === "file:" ? "http://localhost:8080/graphql" : "/graphql";

      queryEl.value = `# User API examples
query Users {
  users { id username email }
}

# mutation CreateUser($username: String!, $email: String!) {
#   createUser(username: $username, email: $email) { id username email }
# }`;

      varsEl.value = JSON.stringify({ username: "mkk", email: "mkk@example.com" }, null, 2);

      async function send() {
        outEl.textContent = "Loading...";
        let variables = {};
        try {
          variables = varsEl.value.trim() ? JSON.parse(varsEl.value) : {};
        } catch (e) {
          outEl.textContent = "Variables JSON parse error: " + e;
          return;
        }

        const res = await fetch(graphqlUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            query: queryEl.value,
            variables,
          }),
        });

        const text = await res.text();
        try {
          outEl.textContent = JSON.stringify(JSON.parse(text), null, 2);
        } catch {
          outEl.textContent = text;
        }
      }

      btn.addEventListener("click", send);
      send();
    </script>
  </body>
</html>

